# PHP-OS

The PHP-OS is implemented an Operating System written in PHP.
This is **not an emulator** for architectures; for example. i386, x86_64 and so on.
This project makes an assembly or image file directly for an operating system.

Moreover, this is very ultra hyper maximum experimental implementation.

## Requirements

- PHP 8.3+
- qemu
- nasm
- make

## Notice

In currently status, this project only implements  **Intel x86_64** architecture.
But you can try this architecture with using QEMU on aarch (macOS M1, M2).

## Quick Start

1. Install PHP-OS via composer.

```
$ composer require m3m0r7/php-os
```

2. Write an example code as `HelloWorld.php` as following.

```php
<?php

require __DIR__ . '/vendor/autoload.php';

$bootloader = new \PHPOS\OS\Code(
    new \PHPOS\Architecture\Architecture(
        // Use x86_64 architecture
        \PHPOS\Architecture\ArchitectureType::x86_64,
    ),
    new \PHPOS\OS\Option(
        new \PHPOS\OS\IO(),
    ),
);

// Create `dist` directory for store assembly files
@mkdir(__DIR__ . '/dist');

// Initialize bootloader
$bootloader
    // Define bootloader
    ->registerService(\PHPOS\Service\BIOS\Standard\DefineBitSize::class, \PHPOS\OS\BitType::BIT_16)
    ->registerService(\PHPOS\Service\BIOS\Standard\DefineOrigin::class, \PHPOS\OS\OSInfo::MBR->value)

    // Use a minimum example for printing Hello World into BIOS screen
    ->registerService(\PHPOS\Service\Kit\Startup\HelloWorld::class)

    // Add bootloader signature
    ->registerPostService(\PHPOS\Service\BIOS\Bootloader\BootloaderSignature::class)

    // Bridge to assembler
    ->assemble()

    // Save as a boot.asm file
    ->saveAsReadable(
        // Specify save path
        new \PHPOS\Stream\File(fopen(__DIR__ . '/dist/boot.asm', 'w+')),

        // Or save to on-memory.
        // new \PHPOS\Stream\Memory(),
    );
```

3. Make nasm instructions and build an OS image as following.

```
$ make
```

4. Start QEMU with qemu command as following.
```
$ qemu-system-x86_64 -drive file=./dist/php-os.img,format=raw
```

5. Show figure as following if you successfully to run the QEMU.

<img src="./doc/demo.png" width="100%">


The quick start example will generate a `boot.asm` as following:
```asm
;
;                                  _     _          __             _____  _    _ _____         ____   _____
;     /\                          | |   | |        / _|           |  __ \| |  | |  __ \       / __ \ / ____|
;    /  \   ___ ___  ___ _ __ ___ | |__ | |_   _  | |_ ___  _ __  | |__) | |__| | |__) |_____| |  | | (___
;   / /\ \ / __/ __|/ _ \ '_ ` _ \| '_ \| | | | | |  _/ _ \| '__| |  ___/|  __  |  ___/______| |  | |\___ \
;  / ____ \__ \__ \  __/ | | | | | |_) | | |_| | | || (_) | |    | |    | |  | | |          | |__| |____) |
; /_/    \_\___/___/\___|_| |_| |_|_.__/|_|\__, | |_| \___/|_|    |_|    |_|  |_|_|           \____/|_____/
;                                           __/ |
;                                          |___/
;
; Notice: This file is automatically generated by PHP-OS.
;         Do not edit this file. We cannot be held responsible if this is edited and overwritten again.
;

[bits 16]

[org 0x7c00]

main:
  xor ax, ax
  mov ds, ax
  mov es, ax
  mov ss, ax
  mov si, hello_world
  call __php_PHPOS_Service_BIOS_IO_PrintString
  ret
  __php_PHPOS_Service_BIOS_IO_PrintString_PHPOS_Service_BIOS_IO_PrintCharacter:
    mov ah, 0x0E
    int 0x10
    ret
  __php_PHPOS_Service_BIOS_IO_PrintString:
    lodsb
    or al, al
    jz __php_PHPOS_Service_BIOS_IO_PrintString_PHPOS_Service_BIOS_Standard_Return_
    call __php_PHPOS_Service_BIOS_IO_PrintString_PHPOS_Service_BIOS_IO_PrintCharacter
    jmp __php_PHPOS_Service_BIOS_IO_PrintString
    __php_PHPOS_Service_BIOS_IO_PrintString_PHPOS_Service_BIOS_Standard_Return_:
      ret

hello_world:
  db "Hello World!", 0

times 510-($-$$) db 0
dw 0xAA55

```

## Test

```
$ ./vendor/bin/phpunit tests/
```

## Linting

```
$ ./vendor/bin/php-cs-fixer fix src/ tests/
```

## License

MIT
